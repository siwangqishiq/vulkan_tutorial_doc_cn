# 纹理映射

## 图像 

### 介绍

现在几何体，已经被逐个顶点地设置了颜色,但这是一个相当受限的方案.在本章教程中我们会去实现纹理的映射从而让几何体看起来更加的有趣.这将帮助我们在未来的章节中去导入基础的3D模型。

要为程序添加纹理涉及到以下几个步骤:

- 基于设备内存创建一张图像
- 使用文件中读取出的像素点来填充它
- 创建一个图像采样器
- 添加一个包含了图像采样器的描述符可以从纹理中进行采样
  
我们已经在前面与图像对象打过交道了,不过之前的图像是我们通过交换链拓展自动获取到的。这一次我们会自己创建图像,创建一幅图像并用数据填充它这与顶点缓冲区的创建时类似的，我们首先创建出一个临时资源，用像素数据来填充它，然后我们拷贝这个临时对象到最终的图像对象中,最终的图像对象就是我们会在渲染中使用的。尽管也可以创建一个临时的图像，Vulkan也允许拷贝像素点到临时的图像中,并且这个API在一些硬件上也的确效率很高.但是这里我们首先创建缓冲区并用像素去填充它,然后我们再创建一幅图像用于拷贝这些像素点.这涉及到内存种类的查询，设备内存的分配与绑定。

然而针对图像，也有一些额外的处理,图像有不同的布局会影响到像素在内存中如何被组织.由于硬件的工作方式，简单的一行一行的存储并不是最高效的,例如,当在图像上要实现一些操作时,必须确保他们有与此操作对应的最适合的布局，实际上我们已经在渲染通道中接触过一些布局了.

- VK_IMAGE_LAYOUT_PRESENT_SRC_KHR : 最适合显式
- VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL : 适合从片段着色器写入颜色附件
- VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL : 在传输操作中适合作为一个源，例如 vkCmdCopyImageToBuffer
- VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL : 适合作为传输操作中的目的地,例如 vkCmdCopyBufferToImage
- VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL : 适合用作着色器中的采样
  
一个转换图像布局最常用的方式是管线屏障(pipeline barrier),管线屏障主要用于同步资源的访问,例如确保一个图像在其读取之前已经被写入了,不过这里也可以被用于布局转换.本章会演示如何使用管线屏障完成转换.管线屏障也可以对那些使用了 VK_SHARING_MODE_EXCLUSIVE 模式的队列簇进行传输操作.

